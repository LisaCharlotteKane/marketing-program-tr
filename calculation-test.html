<!DOCTYPE html>
<html>
<head>
    <title>Calculation Test</title>
</head>
<body>
    <h1>Campaign Calculation Test</h1>
    <div id="results"></div>
    
    <script>
        // Test the corrected calculation logic
        function calculateMetrics(expectedLeads, forecastedCost, campaignType) {
            const leads = Number(expectedLeads) || 0;
            const cost = Number(forecastedCost) || 0;
            
            // Special logic for In-Account Events (1:1)
            const isInAccountEvent = campaignType?.includes("In-Account") || 
                                   campaignType?.includes("In Account") ||
                                   campaignType === "In-Account Events (1:1)";
            
            if (isInAccountEvent && leads === 0) {
                const pipeline = cost * 20;
                return {
                    mql: 0,
                    sql: 0,
                    opportunities: 0,
                    pipelineForecast: pipeline
                };
            }
            
            // Updated calculation flow per requirements:
            // Expected Leads (user input)
            // MQL Forecast = 10% of Expected Leads  
            const mql = Math.round(leads * 0.1);
            
            // SQL Forecast = 6% of Expected Leads (corrected calculation)
            const sql = Math.round(leads * 0.06);
            
            // # Opportunities = 80% of SQL Forecast
            const opportunities = Math.round(sql * 0.8);
            
            // Pipeline Forecast = # Opportunities Ã— $50K
            const pipelineForecast = opportunities * 50000;
            
            return { mql, sql, opportunities, pipelineForecast };
        }
        
        // Test cases
        const testCases = [
            { leads: 1000, cost: 10000, type: "Webinars", name: "Standard Campaign with 1000 leads" },
            { leads: 500, cost: 5000, type: "Webinars", name: "Standard Campaign with 500 leads" },
            { leads: 0, cost: 25000, type: "In-Account Events (1:1)", name: "In-Account Event (no leads)" },
            { leads: 100, cost: 15000, type: "In-Account Events (1:1)", name: "In-Account Event (with leads)" }
        ];
        
        let results = "<h2>Test Results:</h2>";
        
        testCases.forEach((test, index) => {
            const metrics = calculateMetrics(test.leads, test.cost, test.type);
            results += `
                <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                    <h3>Test ${index + 1}: ${test.name}</h3>
                    <p><strong>Input:</strong> ${test.leads} leads, $${test.cost} cost, ${test.type}</p>
                    <p><strong>Results:</strong></p>
                    <ul>
                        <li>MQLs: ${metrics.mql} (should be ${Math.round(test.leads * 0.1)})</li>
                        <li>SQLs: ${metrics.sql} (should be ${Math.round(test.leads * 0.06)})</li>
                        <li>Opportunities: ${metrics.opportunities} (should be ${Math.round(Math.round(test.leads * 0.06) * 0.8)})</li>
                        <li>Pipeline: $${metrics.pipelineForecast.toLocaleString()}</li>
                    </ul>
                    <p style="color: ${
                        metrics.mql === Math.round(test.leads * 0.1) && 
                        metrics.sql === Math.round(test.leads * 0.06) ? 'green' : 'red'
                    }">
                        <strong>${
                            metrics.mql === Math.round(test.leads * 0.1) && 
                            metrics.sql === Math.round(test.leads * 0.06) ? 'PASS' : 'FAIL'
                        }</strong>
                    </p>
                </div>
            `;
        });
        
        document.getElementById('results').innerHTML = results;
    </script>
</body>
</html>